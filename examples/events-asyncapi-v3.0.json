{
  "asyncapi": "3.0.0",
  "info": {
    "title": "User Events API",
    "version": "1.0.0",
    "description": "Kafka-based event streaming API for user lifecycle events",
    "contact": {
      "name": "Platform Team",
      "email": "platform@example.com"
    }
  },
  "servers": {
    "production": {
      "host": "kafka.example.com:9092",
      "protocol": "kafka",
      "description": "Production Kafka cluster"
    },
    "staging": {
      "host": "kafka-staging.example.com:9092",
      "protocol": "kafka",
      "description": "Staging Kafka cluster"
    }
  },
  "channels": {
    "userSignup": {
      "address": "user.signup",
      "messages": {
        "userSignedUp": {
          "$ref": "#/components/messages/UserSignedUp"
        }
      },
      "description": "Channel for user signup events"
    },
    "userProfile": {
      "address": "user.profile.updated",
      "messages": {
        "profileUpdated": {
          "$ref": "#/components/messages/ProfileUpdated"
        }
      },
      "description": "Channel for user profile update events"
    },
    "userDeletion": {
      "address": "user.deleted",
      "messages": {
        "userDeleted": {
          "$ref": "#/components/messages/UserDeleted"
        }
      },
      "description": "Channel for user deletion events"
    }
  },
  "operations": {
    "onUserSignup": {
      "action": "receive",
      "channel": {
        "$ref": "#/channels/userSignup"
      },
      "summary": "Notified when a new user signs up",
      "description": "Consume user signup events from the Kafka topic"
    },
    "onProfileUpdate": {
      "action": "receive",
      "channel": {
        "$ref": "#/channels/userProfile"
      },
      "summary": "Notified when a user profile is updated",
      "description": "Consume profile update events"
    },
    "publishUserDeletion": {
      "action": "send",
      "channel": {
        "$ref": "#/channels/userDeletion"
      },
      "summary": "Publish user deletion event",
      "description": "Send a message when a user account is deleted"
    }
  },
  "components": {
    "messages": {
      "UserSignedUp": {
        "name": "UserSignedUp",
        "title": "User Signed Up Event",
        "summary": "Event published when a new user creates an account",
        "contentType": "application/json",
        "payload": {
          "type": "object",
          "required": ["userId", "email", "signupDate"],
          "properties": {
            "userId": {
              "type": "string",
              "description": "Unique user identifier",
              "example": "user_123456"
            },
            "email": {
              "type": "string",
              "format": "email",
              "description": "User's email address"
            },
            "username": {
              "type": "string",
              "description": "User's chosen username"
            },
            "signupDate": {
              "type": "string",
              "format": "date-time",
              "description": "Timestamp when the user signed up"
            },
            "referralSource": {
              "type": "string",
              "description": "How the user found the service",
              "enum": ["organic", "referral", "advertisement", "social"]
            }
          }
        }
      },
      "ProfileUpdated": {
        "name": "ProfileUpdated",
        "title": "Profile Updated Event",
        "summary": "Event published when a user updates their profile",
        "contentType": "application/json",
        "payload": {
          "type": "object",
          "required": ["userId", "updatedFields", "updateTime"],
          "properties": {
            "userId": {
              "type": "string",
              "description": "User identifier"
            },
            "updatedFields": {
              "type": "array",
              "items": {
                "type": "string"
              },
              "description": "List of fields that were updated"
            },
            "profileData": {
              "type": "object",
              "description": "Updated profile information",
              "properties": {
                "displayName": {
                  "type": "string"
                },
                "bio": {
                  "type": "string"
                },
                "avatarUrl": {
                  "type": "string",
                  "format": "uri"
                }
              }
            },
            "updateTime": {
              "type": "string",
              "format": "date-time",
              "description": "When the update occurred"
            }
          }
        }
      },
      "UserDeleted": {
        "name": "UserDeleted",
        "title": "User Deleted Event",
        "summary": "Event published when a user account is deleted",
        "contentType": "application/json",
        "payload": {
          "type": "object",
          "required": ["userId", "deletionDate", "reason"],
          "properties": {
            "userId": {
              "type": "string",
              "description": "ID of the deleted user"
            },
            "email": {
              "type": "string",
              "format": "email",
              "description": "Email address (for audit purposes)"
            },
            "deletionDate": {
              "type": "string",
              "format": "date-time",
              "description": "When the account was deleted"
            },
            "reason": {
              "type": "string",
              "enum": ["user_request", "policy_violation", "inactivity", "admin_action"],
              "description": "Reason for account deletion"
            },
            "dataRetentionDays": {
              "type": "integer",
              "description": "Number of days before permanent data deletion",
              "default": 30
            }
          }
        }
      }
    }
  }
}
